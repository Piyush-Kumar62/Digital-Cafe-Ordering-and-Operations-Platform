<section class="owner-dashboard section">
  <div class="container-fluid">
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h2 class="mb-1"><i class="bi bi-shop me-2"></i>Café Owner Dashboard</h2>
            <p class="text-muted mb-0">Your café performance at a glance</p>
          </div>
          <div>
            <button class="btn btn-success me-2" routerLink="/create-staff">
              <i class="bi bi-person-plus me-2"></i>Manage Staff
            </button>
            <button class="btn btn-primary" (click)="loadDashboard()">
              <i class="bi bi-arrow-clockwise me-2"></i>Refresh
            </button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="isLoading" class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3">Loading dashboard data...</p>
    </div>

    <div *ngIf="errorMessage" class="alert alert-danger">
      <i class="bi bi-exclamation-circle me-2"></i>{{ errorMessage }}
    </div>

    <div *ngIf="dashboard && !isLoading">
      <!-- Revenue Stats Row -->
      <div class="row g-4 mb-4">
        <div class="col-xl-3 col-md-6">
          <div class="stat-card revenue-card">
            <div class="stat-icon bg-success">
              <i class="bi bi-currency-rupee"></i>
            </div>
            <div class="stat-content">
              <h3>{{ formatCurrency(dashboard.todayRevenue) }}</h3>
              <p>Today's Revenue</p>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6">
          <div class="stat-card revenue-card">
            <div class="stat-icon bg-primary">
              <i class="bi bi-wallet2"></i>
            </div>
            <div class="stat-content">
              <h3>{{ formatCurrency(dashboard.monthlyRevenue) }}</h3>
              <p>Monthly Revenue</p>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6">
          <div class="stat-card">
            <div class="stat-icon bg-warning">
              <i class="bi bi-receipt"></i>
            </div>
            <div class="stat-content">
              <h3>{{ dashboard.todayOrders }}</h3>
              <p>Today's Orders</p>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6">
          <div class="stat-card">
            <div class="stat-icon bg-info">
              <i class="bi bi-calendar-check"></i>
            </div>
            <div class="stat-content">
              <h3>{{ dashboard.todayBookings }}</h3>
              <p>Today's Bookings</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Café Resources Row -->
      <div class="row g-4 mb-4">
        <div class="col-xl-3 col-md-6">
          <div class="stat-card">
            <div class="stat-icon bg-secondary">
              <i class="bi bi-table"></i>
            </div>
            <div class="stat-content">
              <h3>{{ dashboard.totalTables }}</h3>
              <p>Total Tables</p>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6">
          <div class="stat-card">
            <div class="stat-icon bg-danger">
              <i class="bi bi-egg-fried"></i>
            </div>
            <div class="stat-content">
              <h3>{{ dashboard.totalMenuItems }}</h3>
              <p>Menu Items</p>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6">
          <div class="stat-card">
            <div class="stat-icon bg-success">
              <i class="bi bi-person-badge"></i>
            </div>
            <div class="stat-content">
              <h3>{{ dashboard.totalChefs }}</h3>
              <p>Chefs</p>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6">
          <div class="stat-card">
            <div class="stat-icon bg-info">
              <i class="bi bi-person-workspace"></i>
            </div>
            <div class="stat-content">
              <h3>{{ dashboard.totalWaiters }}</h3>
              <p>Waiters</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Revenue Chart -->
      <div class="row g-4 mb-4">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-header bg-white">
              <h5 class="mb-0"><i class="bi bi-graph-up me-2"></i>Revenue Trend (Last 7 Days)</h5>
            </div>
            <div class="card-body">
              <div class="chart-container">
                <canvas
                  baseChart
                  [data]="revenueChartData"
                  [options]="revenueChartOptions"
                  [type]="revenueChartType"
                >
                </canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Popular Items -->
      <div class="row">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-header bg-white">
              <h5 class="mb-0"><i class="bi bi-star-fill me-2"></i>Popular Menu Items</h5>
            </div>
            <div class="card-body">
              <div *ngIf="dashboard.popularItems.length === 0" class="text-center py-4">
                <i class="bi bi-inbox" style="font-size: 3rem; color: #ccc"></i>
                <p class="text-muted mt-2">No data available yet</p>
              </div>
              <div *ngIf="dashboard.popularItems.length > 0" class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Item Name</th>
                      <th>Orders</th>
                      <th>Popularity</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of dashboard.popularItems; let i = index">
                      <td>
                        <span
                          class="rank-badge"
                          [class.rank-gold]="i === 0"
                          [class.rank-silver]="i === 1"
                          [class.rank-bronze]="i === 2"
                        >
                          {{ i + 1 }}
                        </span>
                      </td>
                      <td>
                        <strong>{{ item.name }}</strong>
                      </td>
                      <td>
                        <span class="badge bg-primary">{{ item.orderCount }} orders</span>
                      </td>
                      <td>
                        <div class="progress" style="height: 20px">
                          <div
                            class="progress-bar bg-success"
                            role="progressbar"
                            [style.width.%]="
                              (item.orderCount / dashboard.popularItems[0].orderCount) * 100
                            "
                            [attr.aria-valuenow]="item.orderCount"
                            aria-valuemin="0"
                            [attr.aria-valuemax]="dashboard.popularItems[0].orderCount"
                          >
                            {{
                              (
                                (item.orderCount / dashboard.popularItems[0].orderCount) *
                                100
                              ).toFixed(0)
                            }}%
                          </div>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
